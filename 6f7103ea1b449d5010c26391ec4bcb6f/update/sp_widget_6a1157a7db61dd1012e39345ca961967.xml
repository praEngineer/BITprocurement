<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($rootScope,$scope, spUtil) {
	/* widget controller */
	var c = this;
console.log("ONE MESSAGES");
	c.selectItem = function(idx) {
		var id = c.data.apps[idx].sys_id;
		console.log('App ID: ' + id);
		$rootScope.appID = id;
		$rootScope.$emit('selectApp', id);
		
console.log("EMIT MESSAGE");
	}
	
console.log("BEFORE RECORD WATCH");

  // insert record in list if state is 3 (Approvals Requested)
	spUtil.recordWatch($scope, "x_dosny_bit_procur_bit_procurement_approval", "approval_requested=true", function(name) {
		//spUtil.recordWatch($scope, "x_dosny_dsny_procu_dsny_procurement_approvals", "state=1000", function(name) {
	//spUtil.recordWatch($scope, "x_dosny_dsny_procu_dsny_procurement_approvals", "", function(name) {
console.log("IN RECORD WATCH");
		console.log(name.data.operation); 
		console.log(name); 
		console.log("HELLO");

		// insert record added on server into the list
		if(name.data.operation == "insert"){
console.log("INSERT")
			c.server.refresh();
		}
		if(name.data.operation == "update"){			
console.log("UPDATE");
			c.server.refresh();
		}
	});
}
]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>bit_procurement_approval_list</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) { 

 }]]></link>
        <name>BIT Procurement Approval_List</name>
        <option_schema/>
        <public>true</public>
        <roles/>
        <script><![CDATA[(function() {

//gs.addInfoMessage("TEST");
	
	//create an array to populate with approvals
	data.apps = [];
	var appGR = new GlideRecord('x_dosny_bit_procur_bit_procurement_approval');
	appGR.addQuery('assigned_to', gs.getUser().getID());
	//appGR.addQuery('state', 1000);
	appGR.addQuery('approval_requested', true);
	appGR.orderByDesc('sys_created_on');
	appGR.query();
	
	while (appGR.next()) {
		var appObj = {};
		//use service portal helper method to get some display values
		$sp.getRecordDisplayValues(appObj, appGR, 'number,short_description,sys_id');
		//get the first 20 characters of the description
		appObj.name = appGR.getValue('short_description').slice(0,20);
		//push the populated obj into the array
		data.apps.push(appObj);
	}
})();

]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>clombardi</sys_created_by>
        <sys_created_on>2022-09-01 17:42:24</sys_created_on>
        <sys_id>6a1157a7db61dd1012e39345ca961967</sys_id>
        <sys_mod_count>5</sys_mod_count>
        <sys_name>BIT Procurement Approval_List</sys_name>
        <sys_package display_value="BIT Procurement" source="x_dosny_bit_procur">6f7103ea1b449d5010c26391ec4bcb6f</sys_package>
        <sys_policy/>
        <sys_scope display_value="BIT Procurement">6f7103ea1b449d5010c26391ec4bcb6f</sys_scope>
        <sys_update_name>sp_widget_6a1157a7db61dd1012e39345ca961967</sys_update_name>
        <sys_updated_by>clombardi</sys_updated_by>
        <sys_updated_on>2022-09-01 18:51:33</sys_updated_on>
        <template><![CDATA[<div class="panel panel-default">
  <div class="panel-heading clearfix">
    <h3 class="panel-title pull-left">
      ${Requested Approvals} 
    </h3>
  </div>
  <div class="list-group">
    <a class="list-group-item" ng-click="c.selectItem($index)" ng-repeat="app in data.apps">
      <h4 class="list-group-item-heading">
        {{app.name}}
        
      </h4>
      <p class="list-group-item-text">
        {{app.number}}
      </p>
    </a>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
